{% extends "base.html" %}
{% from 'bootstrap5/utils.html' import render_messages %}
{% block title %}RansomLook - Open Ransomware Intelligence{% endblock %}
{% block content %}
{{ render_messages(container=True, dismissible=True) }}

<!-- Hero Section -->
<section class="hero-section">
    <img src="/static/{{logo}}" alt="RansomLook Logo" class="hero-logo">
    <h1 class="hero-title">Welcome to RansomLook</h1>
    <p class="hero-subtitle">Open-source project providing real-time ransomware intelligence.</p>
    <div class="hero-buttons">
        <a href="{{ url_for('recent') }}" class="btn-hero-primary">Explore Recent Posts</a>
        <a href="/doc/" class="btn-hero-secondary">Use the API</a>
        <a href="{{ url_for('about') }}" class="btn-hero-secondary">About</a>
    </div>
</section>

<!-- Gradient Line -->
<hr class="gradient-line">

<!-- Metrics Section -->
<div class="metrics-grid">
    <!-- Group Metrics -->
    <div class="metric-card">
        <h3 class="metric-card-title">Group Metrics</h3>
        <div class="metric-item">
            <span class="metric-label">Groups tracked</span>
            <span class="metric-value">{{ data['nbgroups'] }}</span>
        </div>
        <div class="metric-item">
            <span class="metric-label">Relays online</span>
            <span class="metric-value">{{ data['online'] }} <span class="metric-value-small">of {{ data['nblocations'] }} total</span></span>
        </div>
        <div class="metric-item">
            <span class="metric-label">DLS</span>
            <span class="metric-value">{{ data['nbdls'] }}</span>
        </div>
        <div class="metric-item">
            <span class="metric-label">FS</span>
            <span class="metric-value">{{ data['nbfs'] }}</span>
        </div>
        <div class="metric-item">
            <span class="metric-label">Chats</span>
            <span class="metric-value">{{ data['nbchat'] }}</span>
        </div>
        <div class="metric-item">
            <span class="metric-label">Admin/Affiliates</span>
            <span class="metric-value">{{ data['nbadmin'] }}</span>
        </div>
    </div>

    <!-- Post Metrics -->
    <div class="metric-card">
        <h3 class="metric-card-title">Post Metrics</h3>
        <div class="metric-item">
            <span class="metric-label">Posts (24h)</span>
            <span class="metric-value">{{ data['24h'] }}</span>
        </div>
        <div class="metric-item">
            <span class="metric-label">Posts (this month)</span>
            <span class="metric-value">{{ data['monthlypost'] }} <span class="metric-value-small">{{ data['month'] }}</span></span>
        </div>
        <div class="metric-item">
            <span class="metric-label">Posts (90 days)</span>
            <span class="metric-value">{{ data['90d'] }}</span>
        </div>
        <div class="metric-item">
            <span class="metric-label">Posts (this year)</span>
            <span class="metric-value">{{ data['yearlypost'] }} <span class="metric-value-small">{{ data['year'] }}</span></span>
        </div>
        <div class="metric-item">
            <span class="metric-label">Total posts</span>
            <span class="metric-value">{{ data['nbposts'] }}</span>
        </div>
    </div>

    <!-- Other Metrics -->
    <div class="metric-card">
        <h3 class="metric-card-title">Other Metrics</h3>
        <div class="metric-item">
            <span class="metric-label">Markets</span>
            <span class="metric-value">{{ data['nbforum'] }}</span>
        </div>
        <div class="metric-item">
            <span class="metric-label">Markets relays online</span>
            <span class="metric-value">{{ data['forumonline'] }} <span class="metric-value-small">of {{ data['nbforumlocations'] }} total</span></span>
        </div>
        <div class="metric-item">
            <span class="metric-label">Telegram channels</span>
            <span class="metric-value">{{ data['nbtelegram'] }}</span>
        </div>
        <div class="metric-item">
            <span class="metric-label">Parsers</span>
            <span class="metric-value">{{ data['nbparsers'] }}</span>
        </div>
    </div>
</div>

{% if alert is true %}
<!-- Alerts Section -->
<div class="container" style="margin-top: 2rem;">
    <h2 style="text-align: center; margin-bottom: 1.5rem;">Alerts within the last 24h</h2>
    
    {% if 'group' in posts %}
    <div class="group-card">
        <div class="group-card-header">
            <h3 class="group-card-title">Groups and Markets</h3>
        </div>
        <div class="group-card-body">
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th style="width:15%">Name</th>
                            <th style="width:15%">Title</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in posts['group'] %}
                        <tr>
                            <td>{{ item['group_name'] }}</td>
                            <td>{{ item['post_title'] }}</td>
                            <td>{{ item['description'] }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}

    {% if 'telegram' in posts %}
    <div class="group-card">
        <div class="group-card-header">
            <h3 class="group-card-title">Telegram</h3>
        </div>
        <div class="group-card-body">
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th style="width:15%">Name</th>
                            <th>Message</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in posts['telegram'] %}
                        <tr>
                            <td>{{ item['group_name'] }}</td>
                            <td>{{ item['description'] }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}

    {% if 'twitter' in posts %}
    <div class="group-card">
        <div class="group-card-header">
            <h3 class="group-card-title">Twitter</h3>
        </div>
        <div class="group-card-body">
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th style="width:15%">Name</th>
                            <th>Tweet</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in posts['twitter'] %}
                        <tr>
                            <td>{{ item['group_name'] }}</td>
                            <td>{{ item['description'] }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endif %}

{% endblock %}
